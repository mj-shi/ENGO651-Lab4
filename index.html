<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
        <script type = "text/javascript" language = "javascript">
            var mqtt;
            var reconnectTimeout = 2000;
            var host = "test.mosquitto.org";
            var port = 8081;
            var connection_flag = 0;

            function onConnectionLost() {
                console.log("Connection lost");
                connection_flag = 0;
            }

            function onConnect() {
                console.log("Connected to " + host + "on port " + port);
                mqtt.subscribe("sensor1");
                message = new Paho.MQTT.Message("Hello World");
                message.destinationName = "sensor1";
                mqtt.send(message);
            }

            function onConnected(recon, url){
                console.log("is onConnected");
            }

            function onFailure(){
                console.log("Connection Attempt to Host " + host + "Failed");
                setTimeout(MQTTconnect, reconnectTimeout);

            }

            function onMessageArrived(msg){
                out_msg = msg.payloadString;
                console.log(out_msg);
            }

            function MQTTconnect() {
                console.log("Connecting to " + host + " " + port);
                mqtt = new Paho.MQTT.Client(host, port, "clientId");
                var options = {
                    timeout: 4000,
                    onSuccess: onConnect,
                    onFailure: onFailure,
                };
                mqtt.onMessageArrived = onMessageArrived;
                mqtt.onConnectionLost = onConnectionLost;
                mqtt.connect(options);
            }

        </script>
        <title>Lab 4 Map</title>
    </head>
    <body>
        <h1>
            MQTT IoT App
        </h1>
        <br/>
        <script>
            MQTTconnect();
        </script>
    </body>
</html>